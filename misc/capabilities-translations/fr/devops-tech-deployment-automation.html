<html devsite><head><meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
    <title>Technologies DevOps : automatisation des déploiements</title>
    <meta name="book_path" value="/architecture/devops/_book.yaml"/>
    <meta name="project_path" value="/architecture/devops/_project.yaml"/>
    <meta name="translation_service" value="machine_translation_light_post_edit"/>
  </head>
  <body>
<aside class="note"><strong>Remarque</strong> : <span>L'<em>automatisation des déploiements</em> figure parmi un ensemble de capacités permettant d'optimiser les performances organisationnelles et de livraison de logiciels. Ces capacités ont été découvertes par le <a href="https://www.devops-research.com/research.html">programme de recherche DevOps Research and Assessment (DORA)</a>, une investigation indépendante et rigoureuse concernant les pratiques et les capacités permettant d'optimiser les performances. Pour en savoir plus, consultez nos <a href="/devops">ressources DevOps</a>.</span></aside>
<p>L'automatisation des déploiements vous permet de déployer votre logiciel dans des environnements de test ou de production en appuyant simplement sur un bouton. L'automatisation est essentielle pour réduire les risques inhérents aux déploiements en production. Il est également essentiel pour vous de pouvoir rapidement obtenir un retour sur la qualité de votre logiciel. Pour cela, vous devez permettre aux équipes de réaliser des tests exhaustifs dès que possible après chaque modification.</p>

<p>Un processus de déploiement automatisé se compose des éléments suivants :</p>

<ul>
<li>Des packages générés dans le cadre du processus d'intégration continue (CI). Ces packages doivent pouvoir être déployés dans tout environnement, y compris en environnement de production.</li>
<li>Des scripts permettant de configurer l'environnement, de déployer les packages et d'effectuer un test du déploiement (parfois appelé <em>test de confiance</em>).</li>
<li>Des informations de configuration spécifiques à l'environnement.</li>
</ul>

<p>Nous vous recommandons de stocker les scripts et les informations de configuration dans le contrôle des versions. Votre processus de déploiement doit télécharger les packages à partir d'un dépôt d'artefacts (par exemple, <a href="/artifact-registry" track-type="article" track-name="internalLink" track-metadata-position="body">Container Registry</a>, <a href="https://www.sonatype.com/nexus-repository-sonatype" target="external" track-type="article" track-name="externalLink" track-metadata-position="body" class="external">Nexus</a>, <a href="https://jfrog.com/artifactory/" target="external" track-type="article" track-name="externalLink" track-metadata-position="body" class="external">Artifactory</a> ou le dépôt intégré de votre outil d'intégration continue).</p>

<p>Les scripts effectuent généralement les tâches suivantes :</p>

<ol>
<li>Ils préparent l'environnement cible. Ils peuvent par exemple installer et configurer les logiciels nécessaires, ou encore démarrer un hôte virtuel à partir d'une image préparée à l'avance et hébergée auprès d'un fournisseur cloud tel que Google Cloud.</li>
<li>Ils déploient les packages.</li>
<li>Ils effectuent certaines tâches liées au déploiement. Ils peuvent par exemple lancer l'exécution des scripts de migration de base de données.</li>
<li>Ils effectuent toutes les opérations de configuration requises.</li>
<li>Ils effectuent en dernier lieu un test de déploiement afin de garantir que tous les services externes nécessaires sont accessibles et que le système fonctionne.</li>
</ol>

<h2 id="how_to_implement_deployment_automation" data-text="Comment mettre en œuvre l'automatisation du déploiement">Comment mettre en œuvre l'automatisation du déploiement</h2>

<p>Lorsque vous concevez votre processus de déploiement automatisé, nous vous recommandons de respecter ces bonnes pratiques :</p>

<ul>
<li><strong>Utilisez le même processus de déploiement pour tous les environnements, y compris l'environnement de production.</strong> Cette règle permet de vous assurer que le processus de déploiement est testé plusieurs fois avant le déploiement en production.</li>
<li><strong>Autorisez toute personne disposant des identifiants nécessaires à déployer n'importe quelle version de l'artefact de façon totalement automatisée dans n'importe quel environnement à la demande.</strong>
Si vous devez à chaque itération créer un ticket et attendre que quelqu'un prépare l'environnement, cela signifie que votre processus de déploiement n'est pas entièrement automatisé.</li>
<li><strong>Utilisez les mêmes packages pour tous les environnements.</strong> Cette règle implique que vous devez maintenir les configurations spécifiques aux différents environnements séparées des packages.
En suivant cette règle, vous avez la garantie que les packages que vous déployez en production sont les mêmes que ceux que vous avez testés.</li>
<li><strong>Faites en sorte qu'il soit possible de recréer l'état de n'importe quel environnement à partir des informations stockées dans le contrôle des versions.</strong> Cette règle permet de s'assurer que les déploiements sont reproductibles et que, dans l'éventualité d'un scénario de reprise après sinistre, vous serez en mesure de restaurer l'état de production de manière déterministe.</li>
</ul>

<p>Idéalement, pour effectuer les déploiements, vous devriez disposer d'un outil permettant de consigner les versions exécutées à l'instant T dans chaque environnement et d'enregistrer les résultats du processus de déploiement à des fins d'audit. De nombreux outils d'intégration continue offrent de telles fonctionnalités.</p>

<h2 id="common_pitfalls_in_deployment_automation" data-text="Problèmes courants liés à l'automatisation du déploiement">Problèmes courants liés à l'automatisation du déploiement</h2>

<p>Lorsque vous tentez d'automatiser votre processus de déploiement, vous devez faire face aux écueils suivants :</p>

<ul>
<li>Complexité du processus existant</li>
<li>Dépendances entre services</li>
<li>Composants qui ne sont pas conçus pour l'automatisation</li>
<li>Mauvaise collaboration entre les équipes</li>
</ul>

<h3 id="complexity" data-text="Complexité">Complexité</h3>

<p>Le premier écueil est lié à la complexité inhérente aux déploiements. Le fait d'automatiser un processus manuel complexe et fragile produit un processus automatisé complexe et fragile. Vous devez en premier lieu repenser votre processus dans l'optique de faciliter les déploiements. Cela signifie que vous devez simplifier autant que possible le script de déploiement et déporter la complexité au niveau du code de l'application et de la plate-forme d'infrastructure. Identifiez les conditions d'échec des déploiements et trouvez comment les contourner en rendant vos services, vos composants, votre plate-forme d'infrastructure et vos outils de surveillance plus intelligents. Les applications cloud natives qui s'exécutent dans un environnement Platform as a Service, tel que <a href="/appengine" track-type="article" track-name="internalLink" track-metadata-position="body">App Engine</a>, <a href="/run" track-type="article" track-name="internalLink" track-metadata-position="body">Cloud Run</a> ou <a href="/architecture/cloud-foundry-on-gcp" track-type="article" track-name="internalLink" track-metadata-position="body">Pivotal Cloud Foundry</a> peuvent généralement être déployées à l'aide d'une seule commande. Aucun script de déploiement n'est nécessaire pour cela : ce type de processus est considéré comme idéal.</p>

<p>Il existe deux propriétés importantes caractérisant un processus de déploiement fiable. Premièrement, les différentes étapes du processus de déploiement doivent dans la mesure du possible être idempotentes. Vous pourrez ainsi les répéter autant de fois que nécessaire en cas de survenue d'un échec. Deuxièmement, elles ne doivent pas être soumises à un quelconque ordre d'exécution. En d'autres termes, les composants et les services ne devraient pas subir de plantages intempestifs si un autre composant ou service attendu est absent. Au lieu de cela, les services devraient continuer à fonctionner en mode dégradé jusqu'à ce que leurs dépendances soient à nouveau disponibles.</p>

<p>Pour les nouveaux produits et services, nous vous recommandons de considérer ces principes comme des exigences système dès le début de la phase de conception. Si vous adaptez l'automatisation à un système existant, il sera certainement nécessaire de travailler à la mise en œuvre de ces caractéristiques ou d'intégrer une solution de télémétrie permettant au processus de déploiement de détecter correctement les états incohérents et les défaillances.</p>

<h3 id="dependencies" data-text="Dépendances">Dépendances</h3>

<p>Le deuxième problème tient au fait que de nombreux processus de déploiement, en particulier dans les environnements d'entreprise, nécessitent une orchestration. En d'autres termes, vous devez déployer plusieurs services ensemble dans un ordre particulier, et dans le même temps effectuer d'autres tâches telles que la migration de bases de données, le tout en assurant une synchronisation parfaite. Bien que de nombreux outils de flux de travail de déploiement en entreprise existent pour remédier à cette situation, ils ne sont fondamentalement qu'une solution de fortune pour traiter un problème d'ordre architectural : le couplage particulièrement étroit entre les divers composants et services. Mais un jour ou l'autre, il deviendra impératif de trouver une solution à ce couplage étroit. L'objectif à terme est que les services puissent être déployés indépendamment les uns des autres, sans que cela ne nécessite une quelconque orchestration.</p>

<p>Une telle approche nécessite généralement une conception minutieuse afin de garantir que chaque service sera en mesure d'assurer la rétrocompatibilité. Ainsi, il ne sera pas nécessaire de procéder à la mise à niveau immédiate des clients du service pour éviter que l'accès leur soit refusé. Ils pourront être mis à niveau indépendamment par la suite.
Des techniques telles que la <a href="/architecture/migrating-a-monolithic-app-to-microservices-gke#api_contracts" track-type="article" track-name="internalLink" track-metadata-position="body">gestion des versions d'API</a> peuvent vous aider à contourner des problèmes de cet ordre. Il est également important de veiller à ce que les services puissent continuer à fonctionner (certaines fonctionnalités pouvant être temporairement indisponibles), même s'ils ne peuvent pas se connecter aux autres services dont ils dépendent. Cette conception est particulièrement adaptée aux systèmes distribués, car elle permet d'éviter les défaillances en cascade. Dans son livre "Release It!", Michael Nygard décrit un certain nombre de modèles de conception bien adaptés aux systèmes distribués, comme les <a href="https://martinfowler.com/bliki/CircuitBreaker.html" target="external" track-type="article" track-name="externalLink" track-metadata-position="body" class="external">disjoncteurs</a>.
Sachez que vous avez même la possibilité de découpler les mises à niveau des bases de données des services dont elles dépendent en appliquant un <a href="https://martinfowler.com/bliki/ParallelChange.html" target="external" track-type="article" track-name="externalLink" track-metadata-position="body" class="external">schéma de propagation parallèle du changement</a>.</p>

<h3 id="not_designed_for_automation" data-text="Composants qui ne sont pas conçus pour l'automatisation">Composants qui ne sont pas conçus pour l'automatisation</h3>

<p>Troisième problème assez courant : les composants qui ne sont pas conçus pour l'automatisation. Tout processus de déploiement nécessitant une connexion à une console et une interaction manuelle avec cette dernière (via des clics, par exemple) doit faire l'objet d'une amélioration. Aujourd'hui, la plupart des plates-formes (y compris Google Cloud) proposent une API que votre script de déploiement peut utiliser. Si ce n'est pas le cas, vous devez faire preuve de créativité pour éviter les interventions manuelles de cet ordre. Vous pouvez par exemple identifier la base de données ou le fichier de configuration utilisé par votre outil et apporter directement les modifications nécessaires. Sinon, vous pouvez remplacer l'outil par une solution équivalente disposant d'une API.</p>

<h3 id="poor_collaboration_between_teams" data-text="Mauvaise collaboration entre les équipes">Mauvaise collaboration entre les équipes</h3>

<p>Le dernier problème se présente lorsque les équipes de développement et d'exploitation informatique ne parviennent pas à se synchroniser.
Cette absence de synchronisation peut prendre plusieurs formes. Par exemple, les développeurs peuvent utiliser une méthode de déploiement alors que l'équipe d'exploitation informatique en utilise une autre. Autre exemple, si les environnements sont configurés différemment, vous augmentez considérablement le risque que le processus de déploiement soit exécuté manuellement par l'équipe d'exploitation informatique, ce qui peut provoquer des incohérences et des erreurs. Le processus d'automatisation des déploiements doit être créé conjointement par les équipes de développement et d'exploitation informatique. Cette approche garantit que les deux équipes sont à même de comprendre, de gérer et de faire évoluer l'automatisation des déploiements.</p>

<h2 id="ways_to_improve_deployment_automation" data-text="Méthodes pour améliorer l'automatisation des déploiements">Méthodes pour améliorer l'automatisation des déploiements</h2>

<p>La première étape consiste à documenter le processus de déploiement existant dans un outil commun auquel les développeurs et l'équipe d'exploitation peuvent accéder. Il peut s'agir de Google Docs ou d'un wiki, par exemple.
Ensuite, les équipes doivent progressivement tenter de simplifier et automatiser le processus de déploiement. Cette approche comprend généralement les opérations suivantes :</p>

<ul>
<li>Générer vos packages de code dans l'optique du déploiement</li>
<li>Créer des machines virtuelles ou des conteneurs préconfigurés</li>
<li>Automatiser le déploiement et la configuration des intergiciels</li>
<li>Copier des packages ou des fichiers dans l'environnement de production</li>
<li>Redémarrer des serveurs, des applications ou des services</li>
<li>Générer des fichiers de configuration à partir de modèles</li>
<li>Effectuer des tests de déploiement automatisé pour s'assurer que le système fonctionne et est correctement configuré</li>
<li>Exécuter des procédures de test</li>
<li>Développer des scripts pour automatiser la migration de bases de données</li>
</ul>

<p>Efforcez-vous de supprimer les étapes manuelles, d'implémenter l'idempotence et l'indépendance vis-à-vis d'un quelconque ordre dans la mesure du possible, et essayez d'exploiter au maximum les capacités de votre plate-forme d'infrastructure. Rappelez-vous à chaque instant que l'automatisation des déploiements doit être aussi simple que possible.</p>

<h2 id="ways_to_measure_deployment_automation" data-text="Méthodes de mesure de l'automatisation du déploiement">Méthodes de mesure de l'automatisation du déploiement</h2>

<p>Mesurer le degré d'automatisation d'un déploiement est relativement simple.</p>

<ul>
<li><strong>Comptez le nombre d'étapes manuelles dans votre processus de déploiement</strong>. Efforcez-vous de réduire systématiquement ces étapes. Le nombre d'étapes manuelles augmente le temps de déploiement et les possibilités d'erreur.</li>
<li><strong>Mesurez le niveau (ou le pourcentage) d'automatisation dans votre pipeline de déploiement</strong>. Vous devez œuvrer à augmenter continuellement ce niveau.</li>
<li><strong>Déterminez le temps perdu à cause des retards se produisant dans le pipeline de déploiement</strong>. Lorsque vous tentez de réduire ces retards, essayez d'identifier où et pourquoi le code présente des ralentissements ou des blocages dans votre pipeline de déploiement.</li>
</ul>

<h2 id="whats_next" data-text="Étapes suivantes">Étape suivante</h2>

<ul>
<li>Consultez la <a href="/devops" track-type="solution" track-name="internalLink" track-metadata-position="body">page DevOps</a> pour obtenir des liens vers d'autres articles et ressources.</li>
<li>Obtenez plus d'informations sur les <a href="/solutions/continuous-delivery" track-type="solution" track-name="internalLink" track-metadata-position="body">solutions de livraison continue</a> de Google Cloud.</li>
<li>Lisez le <a href="https://landing.google.com/sre/books/" target="external" track-type="article" track-name="externalLink" track-metadata-position="body">manuel d'ingénierie en fiabilité des sites</a> (SRE, Site Reliability Engineering), en particulier le <a href="https://landing.google.com/sre/sre-book/chapters/release-engineering/" target="external" track-type="article" track-name="externalLink" track-metadata-position="body">chapitre 8 - Release Engineering</a> (Ingénierie des versions).</li>
<li>Lisez l'article <a href="http://www.informit.com/articles/article.aspx?p=1833567" target="external" track-type="article" track-name="externalLink" track-metadata-position="body" class="external">Four Principles of Low-Risk Software Releases</a> (Quatre principes essentiels pour des versions logicielles à faible risque).</li>
<li>Découvrez notre <a href="https://www.devops-research.com/research.html">programme de recherche</a> DevOps.</li>
<li>Effectuez l'<a href="https://www.devops-research.com/quickcheck.html">évaluation DevOps rapide</a> pour comprendre votre position par rapport au reste du secteur.</li>
</ul>

</body></html>